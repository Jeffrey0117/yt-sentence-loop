# YouTube 逐句循環播放器 - 專案規劃文件

## 專案概述

YouTube 逐句循環播放器是一個專為語言學習設計的 Web 應用程式，讓使用者能夠逐句循環播放 YouTube 影片的字幕，提供更有效的語言學習體驗。

## 技術架構

### 核心技術棧

- **前端框架**: Next.js 14.2.3 (App Router)
- **UI 框架**: React 18.2.0 + TypeScript
- **樣式**: Tailwind CSS 3.4.3
- **字幕處理**: yt-dlp + 自定義 VTT 解析器
- **影片播放**: YouTube IFrame API
- **開發工具**: ESLint, PostCSS, Autoprefixer

### 專案結構

```
yt-sentence-loop/
├── app/                    # Next.js App Router
│   ├── layout.tsx         # 根佈局 + 錯誤邊界
│   ├── page.tsx           # 主應用程式介面
│   ├── globals.css        # 全域樣式
│   └── api/
│       └── transcript/
│           └── route.ts   # 字幕 API 端點
├── lib/                   # 核心功能庫
│   ├── transcript.ts      # yt-dlp 字幕下載邏輯
│   ├── transcriptCache.ts # 字幕快取管理
│   ├── vtt.ts            # VTT 字幕解析器
│   └── security.ts       # 安全性工具
├── package.json          # 專案配置與依賴
├── tailwind.config.js    # Tailwind 配置
├── tsconfig.json         # TypeScript 配置
├── next-env.d.ts         # Next.js 型別定義
├── postcss.config.js     # PostCSS 配置
└── plan.md              # 專案規劃文件
```

## 核心功能

### ✅ 已完成功能

#### 1. 基礎播放功能

- YouTube 影片嵌入播放
- 自動字幕下載與解析
- 逐句循環播放機制
- 播放速度調整 (0.5x - 1.75x)

#### 2. 用戶介面優化

- 響應式設計 (桌面 + 移動端)
- 深色模式支援
- 字幕文字大小調整 (12px-24px)
- 影片和字幕進度條顯示
- 載入狀態動畫和視覺回饋

#### 3. 字幕功能增強

- 即時字幕搜尋與高亮顯示
- 書籤/收藏句子功能 (本地存儲)
- 字幕匯出功能 (TXT, SRT, JSON 格式)
- 多語言字幕支援

#### 4. 播放體驗優化

- 重複間隔設定 (0-5 秒)
- 鍵盤快捷鍵控制:
  - `J` - 上一句
  - `K` - 下一句
  - `L` - 開關循環模式
  - `R` - 重播當前句子
  - `空白鍵` - 播放/暫停

#### 5. 程式碼品質

- 錯誤邊界實作 (React Error Boundary)
- TypeScript 型別安全
- ESLint 程式碼檢查
- 模組化代碼結構

#### 6. 安全性

- YouTube ID 前後端雙重驗證
- XSS 防護機制
- CSRF 保護
- 安全的本地存儲操作
- 輸入清理和 URL 解析安全

### 🔄 進行中功能

#### 1. 效能優化

- [ ] 字幕預載機制
- [ ] 影片預載優化
- [ ] 記憶體使用優化
- [ ] 快取策略改進

#### 2. 待完成功能

- [ ] 鍵盤快捷鍵自定義
- [ ] 單元測試覆蓋率
- [ ] E2E 測試實作
- [ ] 程式碼分割優化

## 開發指南

### 環境需求

- Node.js 16+
- pnpm (推薦) 或 npm
- yt-dlp (系統依賴)

### 安裝與執行

```bash
# 安裝依賴
pnpm install

# 開發模式
pnpm dev

# 建置
pnpm build

# 產品模式
pnpm start

# 程式碼檢查
pnpm lint
```

### 系統依賴安裝

```bash
# Windows (Chocolatey)
choco install yt-dlp

# macOS (Homebrew)
brew install yt-dlp

# Linux (pip)
sudo pip3 install yt-dlp
```

## API 文件

### GET /api/transcript

獲取 YouTube 影片字幕

**參數:**

- `videoId` (string): YouTube 影片 ID (11 字符)
- `lang` (optional): 語言代碼，預設 "en,\*"

**回應:**

```json
{
  "videoId": "dQw4w9WgXcQ",
  "cues": [
    {
      "start": 0.0,
      "end": 3.5,
      "text": "Never gonna give you up"
    }
  ]
}
```

## 部署指南

### 建議平台

- **Fly.io**: 支援 yt-dlp 執行
- **Render**: 容器化部署
- **Railway**: 簡易部署流程
- **自託管**: VPS + Docker

### 部署需求

- 支援執行系統指令 (yt-dlp)
- Node.js 執行環境
- 足夠的暫存空間

## 版本記錄

### v1.1.0 (最新版本)

- ✨ 新增功能：

  - 字體大小調整 (12px-24px)
  - 深色模式切換與完整 UI 支援
  - 影片和字幕進度條
  - 載入狀態動畫優化
  - 即時字幕搜尋與高亮
  - 書籤/收藏句子與本地存儲
  - 字幕匯出功能 (TXT, SRT, JSON)
  - 重複間隔設定 (0-5 秒)

- 🔒 安全性增強：

  - 前後端 YouTube ID 驗證
  - 輸入清理和 URL 解析安全
  - 強化錯誤處理和用戶回饋

- 🐛 錯誤修復：
  - 修復 HTTP 429 速率限制問題
  - 解決自動字幕檢測問題
  - 修復檔案寫入權限問題

### v1.0.0 (初始版本)

- 基礎 YouTube 播放功能
- 字幕下載與解析
- 逐句循環播放
- 鍵盤快捷鍵控制
- 響應式介面設計

## 授權

MIT License

---

**專案狀態**: 🚀 積極開發中
**最後更新**: 2025-09-18
**版本**: v1.1.0
